---
title: "Assessing injury on GOM cetaceans"
author: ""
date: \today
output: 
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: lumen
  pdf_document: default
urlcolor: blue
---

```{r setup, include=FALSE}
library(knitr)
library(bestglm)
knitr::opts_chunk$set(echo = FALSE)
#to NOT disply scientific notation
options(scipen=999)
```


# Preamble

This is an Electronic Supplement to the manuscript Marques et al. "Quantifying Deepwater Horizon oil spill induced injury on pelagic cetaceans" submitted to Marine Ecology Progress Series (MEPS).

There are 8 Electronic Supplements to the paper. The master file containing links to all the other 7 additional Electronic Supplements related to this paper is [ES0_ElectronicSupplements](ES0_ElectronicSupplements.html). 

You might be reading this file as a pdf or as an html. The links on this file only work if you are using the html version of it, available via the github repository or if you compiled it yourself as html and you have all the 8 html files in the same folder. Otherwise, as a pdf distributed as an Electronic Supplement to the MEPS paper, the links might not work. ***They might work. If it is possible, we can work with the MEPS Editorial Office such that we can add links below that will link to actual files, say the pdfs of each of these 8 files, on the publisher server***.

## Version history

This section details the version history for static pdf files submitted as Electronic Supplement pdfs:

* 1.0 [12 Aug 2022] Version included as a pdf Electronic Supplement in the MEPS original submission

* 2.0 [10 Feb 2023] Version included as a pdf Electronic Supplement in the MEPS re-submission after 1st round of reviewer's comments

# Introduction

In this document we present the results of the age, sex and class structured model implemented for all species/stock in the GOM. 

We report here the injury metrics originally considered in Schwacke et al. (2017): (1) lost cetacean years (LCY), the difference between the baseline and injured population sizes, summed over the entire modeled time period; (2) years to recovery (YTR), the number of years required before the injured population trajectory reaches 95% of the baseline population trajectory; and (3) maximum proportional decrease (MPD), the difference between the two population trajectories when the injured trajectory is at its lowest point, divided by the baseline.  Note that LCY is intuitively the metric that is most dependent on initial population size.

# Running the simulations

The code below runs the simulations for all species, and stores the results in appropriate files, stored in appropriate species specific folders. 

This code is included for completeness and does not need to be run as part of compiling this dynamic report as the results are already available in relevant files and it takes a considerably log time to run.

```{r}
#define the species we run simulations for
Sps <- c("Bwsp", "Fatt", "Ggri", "Gmac", "Kosp", "Pele", "Pmac", "Satt", "Sbre", "Scly", "Scoe", "Sfro", "Slon", "Ttro", "Ttrs")
#define the number of iterations to run
ns <- 10000
# define the number of years each iteration is run for
ny <- 75
```

```{r getresults,eval=FALSE}
# this runs all the simulations and produces outputs for all species
# this code chuck is a separate file: "RunAllSims.R"
# that is the file that should be sourced to run the code
# this code is therefore here just for completeness
# DON NOT turn the "eval=FALSE" into "eval=TRUE"
# unless you are willing to wait for many (many!) hours 
# (or even days, depending on the "ns" you choose)
# for your dynamic report to compile
source("Functions/reqfuns.R")         # most functions are here
source("Functions/SilerFuns.R")       # Siler model functions are here
source("Functions/runSims.R")         # To run the simulations for all species
for (i in Sps){
  runPopSims(Sp = i, nsims = ns, nyears = ny, seed = 7134672)
}
```


```{r,cache=FALSE}
source("Functions/reqfuns.R")         # most functions are here
```

Creating objects to hold summary results:

```{r,cache=FALSE,echo=FALSE}
# Set up a table to hold summary statistics by species
sumres <- data.frame(Sp=Sps, No=NA, peo=NA, LCYo=NA, MPDo=NA, YTRo=NA, Nstart=NA, Nexp=NA, Pexp=NA, LCY=NA, MPD=NA, YTR=NA,  LCYmed=NA, MPDmed=NA, YTRmed=NA)
# Injury metrics and respective 95% quantile-method CI's 
injuryCI <- data.frame(Sp=Sps, LCYmed = NA, LCYl = NA, LCYu = NA, MPDmed = NA, MPDl = NA, MPDu = NA, YTRmed = NA, YTRl = NA, YTRu = NA)
# Some relevant inputs (gd gestation duration and sr survival reduction)
inputs <- data.frame(Sp=Sps, gd = NA, sr = NA)
```

The taxonomic units and the corresponding codes considered in this document are:

* Bwsp - beaked whales, Beaked whales spp
* Fatt - pygmy killer whale,	*Feresa attenuata*
* Ggri - Risso's dolphin,	*Grampus griseus*
* Gmac - short-finned pilot whale,	*Globicephala macrorhynchus*
* Kosp - Kogia species,	*Kogia* sp.
* Pele - melon-headed whale,	*Peponocephala electra*
* Pmac - sperm whale,	*Physeter macrocephalus*
* Satt - pantropical spotted dolphin, *Stenella attenuata*
* Sbre - rough-toothed dolphin,	*Steno bredanensis*
* Scly - Clymene dolphin,	*Stenella clymene*
* Scoe - striped dolphin,	*Stenella coeruleoalba*
* Sfro - Atlantic spotted dolphin,	*Stenella frontalis*
* Slon - spinner dolphin,	*Stenella longirostris*
* Ttro - offshore bottlenose dolphins,	*Tursiops truncatus*
* Ttrs - shelf bottlenose dolphins, *Tursiops truncatus*

We re-order the results tables upfront so that results are organized by alphabetical order of the 4 letter code used to describe the taxonomic unit (this is also the order that the species are reported in tables 1 to 3 of the offshore paper).

```{r,echo=FALSE,warning=FALSE,message=FALSE}
# note there is no effect if Sps is already in alphabetical order
# but it is here to make sure that this code will work even if
# the vector Sps is changed
injuryCI <- injuryCI[order(Sps),]
sumres <- sumres[order(Sps),]
inputs <- inputs[order(Sps),]
```

The data for initial population sizes and proportion exposed are imported from a `txt` file produced inside [ES2_ElectronicSupplements](ES2_InitialPopulationSizes.html).

```{r,echo=FALSE}
IniPopSizes <- read.table(file = "Table4GetInjury.txt",header=TRUE)
IniPopSizes <- IniPopSizes[order(Sps),]
```

# Results by species

We represent in turn, for each species, the simulated population trajectories under the oil spill and under the baseline scenarios, as well as the histograms of the distributions of the 3 injury metrics for each species. To each histogram four dashed vertical lines were added:

* green - median value for the injury metric
* black - mean value for the injury metric
* blue - 95% confidence interval for the injury metric

## *Physeter macrocephalus* (Pmac, sperm whale)

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Pmac"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd 
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
#windowsFonts(A = windowsFont("Times New Roman"))  
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE,echo=FALSE}
x <- getInjury(simres)
colMeans(injury)
#apply(injury, 2, median)
```

```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```

```{r,echo=FALSE}
#and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Kogia* sp. (Kosp, kogia)

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Kosp"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r, cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Stenella clymene* (Scly, Clymene dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Scly"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE,echo=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Peponocephala electra* (Pele, melon-headed whale)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Pele"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Tursiops truncatus* (Ttro, offshore bottlenose dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Ttro"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Globicephala macrorhynchus* (Gmac, short finned pilot whale) 

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Gmac"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Feresa attenuata* (Fatt, pygmy killer whale)	


```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Fatt"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Grampus griseus* (Ggri, Risso's dolphin)	

```{r,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Ggri"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Steno bredanensis* (Sbre, rough-toothed dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Sbre"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```

```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Stenella attenuata* (Satt, pantropical spotted dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Satt"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Tursiops truncatus* (Ttrs, shelf bottlenose dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Ttrs"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```

```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Stenella longirostris* (Slon, spinner dolphin)	

```{r,cache=FALSE,message=FALSE,warning=FALSE,echo=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Slon"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Stenella coeruleoalba* (Scoe, striped dolphin)	


```{r,cache=FALSE,message=FALSE,warning=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Scoe"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
# Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## *Stenella frontalis* (Sfro, Atlantic spotted dolphin)	


```{r,cache=FALSE,message=FALSE,warning=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Sfro"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE,echo=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```


```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```


```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

## Beaked whales spp (Bwsp)
 
```{r,cache=FALSE,message=FALSE,warning=FALSE}
donotshow <- gc(verbose=FALSE);Sp <- "Bwsp"
SpInfo <- getSpData(Sp)
load(file=paste0("InOutBySp/", SpInfo$folder, "/", Sp, "simres", ns, "Sim.RData"))
inputs$gd[inputs$Sp==Sp] <- SpInfo$gd
inputs$sr[inputs$Sp==Sp] <- with(SpInfo, mean(rbeta(10000, sra, srb)*(sru-srl)+srl))
```

Population trajectories

```{r,cache=FALSE, dpi=200, dev='jpeg'}
plotSims(simres, nplots=2)
```

Mean for each of the injury metrics

```{r,cache=FALSE}
x <- getInjury(simres)
colMeans(injury)
# apply(injury, 2, median)
```

```{r,cache=FALSE,echo=FALSE}
#Collect information to summary table
sumres[sumres$Sp==Sp, 2:15]<-c(SpInfo$N, SpInfo$pe, SpInfo$LCY, SpInfo$MPD, SpInfo$YTR, IniPopSizes$N[IniPopSizes$Sp==Sp], IniPopSizes$Ne[IniPopSizes$Sp==Sp], IniPopSizes$Pe[IniPopSizes$Sp==Sp], mean(injury$LCY), mean(injury$MPD), mean(injury$YTR),  median(injury$LCY), median(injury$MPD), median(injury$YTR))
```

```{r,echo=FALSE}
# and collect information to injury summary table
injuryCI[injuryCI$Sp==Sp, 2:10]<-c(median(injury$LCY), quantile(injury$LCY, probs=c(0.025,0.975)), median(injury$MPD), quantile(injury$MPD, probs = c(0.025, 0.975)), median(injury$YTR), quantile(injury$YTR,probs = c(0.025, 0.975)))
```

# Comparisons across species

In this section we present some summary analysis of the results across the 15 taxonomic units considered.

```{r}
#just some rounding for nicer visualization below
sumres$Nstart=round(sumres$Nstart)
sumres$Pexp=round(sumres$Pexp,3)
```

## Initial population and proportion exposed

The population size and the proportion exposed are $a priori$ expected to be key determinants of injury, since the population size will have a direct impact on LCY and the proportion exposed should have a direct impact on all 3 measures.

```{r,echo=FALSE}
kable(sumres[, c(1, 7, 9)],caption = "Initial population size (N) and proportion exposed (Pexp) for the different stocks considered.",digits = c(0, 0, 3, 3))
```

The proportion exposed against the initial population size is shown here for the 15 taxonomic units

```{r,echo=FALSE}
plot(sumres[, c(7,9)],xlab="Initial population size",ylab="Proportion exposed",type="n", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
text(x = sumres[, 7],y=sumres[, 9],labels = sumres[, 1])
#plot(sumres[, c(7,9)],xlab="Initial population size",ylab="Proportion exposed",type="n", las = 1, family="A", cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
#text(x = sumres[, 7],y=sumres[, 9],labels = sumres[, 1], family="A")
```

## Injury metrics

In the following table we present the means of the 3 injury metrics:

```{r,cache=FALSE,echo=FALSE}
sumres$MPD <- -(sumres$MPD/100)
kable(sumres[, c(1, 10, 11, 12)],caption = "Injury results for the different stocks considered.",digits = c(0, 0, 3, 1))
```

In the following table we present  the medians and the 95% confidence intervals for our current estimates of injury. These correspond to the results in table 3 in the main paper.

```{r,echo=FALSE}
kable(injuryCI, caption = "Median injury results for the different stocks considered and respective 95% confidence intervals by the percentile method",digits = c(0, 0, 0, 0, 3, 3, 3, 1, 1, 1))
```

These are the values that are used in table 3 of the paper, and the code to do so is in the .Rmd.

```{r,echo=FALSE}
Table3LCY <-  paste0(round(injuryCI$LCYmed,0), " (",round(injuryCI$LCYl,0),", ",round(injuryCI$LCYu),") ")
Table3MPD <-  paste0(round(injuryCI$MPDmed,1), " (",round(injuryCI$MPDl,1),", ",round(injuryCI$MPDu,1), ") ")
Table3YTR <-  paste0(round(injuryCI$YTRmed,1), " (",round(injuryCI$YTRl,1)," ,",round(injuryCI$YTRu,1),")")
# IMPORTANT
# note removing row 16, Ttru, not for the pelagic paper
# These are outputed as 3 separate tables as 
# that facilitates copy-pasting into
# the main paper word document
write.table(Table3LCY[-16],"Table3LCY.txt",sep="\t",row.names = FALSE,quote = FALSE,col.names = FALSE)
write.table(Table3MPD[-16],"Table3MPD.txt",sep="\t",row.names = FALSE,quote = FALSE,col.names = FALSE)
write.table(Table3YTR[-16],"Table3YTR.txt",sep="\t",row.names = FALSE,quote = FALSE,col.names = FALSE)
```

```{r,echo=FALSE}
#creating output tables for others to use
write.table(injuryCI,"injuryCI.txt")
write.table(sumres,"sumres.txt")
```

Representing the above information visually, focusing on each of the 3 injury metrics:

```{r,echo=FALSE}
par(mfrow=c(1,1),mar=c(4,4,0.5,0.5))
plot(sort(injuryCI$LCYmed),1:15,xlab="Lost Cetacean Years",ylab="Taxonomic unit",yaxt="n",xlim=c(0,72000), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
order.index<-order(injuryCI$LCYmed)
axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1)
#axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1,family="A")
for(i in 1:15){
  segments(x0=injuryCI$LCYl[order.index[i]],y0=i,x1=injuryCI$LCYu[order.index[i]],y1=i)
}
```

```{r,echo=FALSE}
par(mfrow=c(1,1),mar=c(4,4,0.5,0.5))
plot(sort(injuryCI$YTRmed),1:15,xlab="Years to Recovery",ylab="Taxonomic unit",yaxt="n",xlim=c(0,25), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
order.index<-order(injuryCI$YTRmed)
axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1)
# axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1,family="A")
for(i in 1:15){
  segments(x0=injuryCI$YTRl[order.index[i]],y0=i,x1=injuryCI$YTRu[order.index[i]],y1=i)
}
abline(v=0,lty=2)
```

```{r,echo=FALSE}
par(mfrow=c(1,1),mar=c(4,4,0.5,0.5))
plot(sort(injuryCI$MPDmed),1:15,xlab="Maximum Proportional Decrease",ylab="Taxonomic unit",yaxt="n",xlim=c(0,20), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
order.index<-order(injuryCI$MPDmed)
axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1)
#axis(2,at=1:15,labels=injuryCI$Sp[order.index],las=1,family="A")
for(i in 1:15){
  segments(x0=injuryCI$MPDl[order.index[i]],y0=i,x1=injuryCI$MPDu[order.index[i]],y1=i)
}
abline(v=0,lty=2)
```


# Exploring the injury metric results

In this section we explore the results obtained in terms of the different injury metrics and how these injury metrics might be explained by the different input parameters. To do so we consider linear models to model the mean value of the injury per species as a function of the mean values of the input parameters. After a preliminary exploratory analysis, only the following four parameters seem to have a non-negligible potential relevant effect on the injury metrics:

* Proportion Exposed
* Initial population size
* Gestation duration
* Survival reduction

## Exploratory analysis

Here we plot the values of the injury metrics as a function of the four key parameters going into the model. 

### Proportion exposed

The next three plots describe the relationship between the proportion exposed and Lost Cetacean Years, the Maximum Proportion Decrease and the Years to recovery, respectively

```{r,echo=FALSE}
#LCY
plot(sumres$Pexp,sumres$LCY, type="n",col=3, xlab="P(exposed)",ylab="LCY", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(sumres$Pexp, sumres$LCY,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$LCY~sumres$Pexp),col=4,lty=2)

#MPD
plot(sumres$Pexp, sumres$MPD, type="n",col=3, xlab="P(exposed)",ylab="MPD", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(sumres$Pexp, sumres$MPD,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$MPD~sumres$Pexp),col=4,lty=2)
#YTR
plot(sumres$Pexp, sumres$YTR, type="n",col=3, xlab="P(exposed)",ylab="YTR", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(sumres$Pexp, sumres$YTR,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$YTR~sumres$Pexp),col=4,lty=2)
```

### Initial population size

The next three plots describe the relationship between the initial population size and Lost Cetacean Years, the Maximum Proportion Decrease and the Years to recovery, respectively.

```{r,echo=FALSE}
#LCY
plot(sumres$Nstart,sumres$LCY, type="n",col=3, xlab="initial population size",ylab="LCY", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(sumres$Nstart, sumres$LCY,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$LCY~sumres$Nstart),col=4,lty=2)
#MPD
plot(sumres$Nstart, sumres$MPD, type="n",col=3, xlab="initial population size",ylab="MPD", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(sumres$Nstart, sumres$MPD,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$MPD~sumres$Nstart),col=4,lty=2)
#YTR
plot(sumres$Nstart, sumres$YTR, type="n",col=3, xlab="initial population size",ylab="YTR", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)

points(sumres$Nstart, sumres$YTR,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$YTR~sumres$Nstart),col=4,lty=2)
```

### Gestation duration


The next three plots describe the relationship between the gestation duration and Lost Cetacean Years, the Maximum Proportion Decrease and the Years to recovery, respectively


```{r,echo=FALSE}
#LCY
plot(inputs$gd,sumres$LCY, type="n",col=3, xlab="gestation duration",ylab="LCY", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$gd, sumres$LCY,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$LCY~inputs$gd),col=4,lty=2)
#MPD
plot(inputs$gd, sumres$MPD, type="n",col=3, xlab="gestation duration",ylab="MPD", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$gd, sumres$MPD,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$MPD~inputs$gd),col=4,lty=2)
#YTR
plot(inputs$gd, sumres$YTR, type="n",col=3, xlab="gestation duration",ylab="YTR", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$gd, sumres$YTR,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$YTR~inputs$gd),col=4,lty=2)
```

### Survival reduction


The next three plots describe the relationship between the survival reduction and Lost Cetacean Years, the Maximum Proportion Decrease and the Years to recovery, respectively


```{r,echo=FALSE}
#LCY
plot(inputs$sr,sumres$LCY, type="n",col=3, xlab="survival reduction",ylab="LCY", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$sr, sumres$LCY,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$LCY~inputs$sr),col=4,lty=2)
#MPD
plot(inputs$sr, sumres$MPD, type="n",col=3, xlab="survival reduction",ylab="MPD", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$sr, sumres$MPD,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$MPD~inputs$sr),col=4,lty=2)
#YTR
plot(inputs$sr, sumres$YTR, type="n",col=3, xlab="survival reduction",ylab="YTR", las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
points(inputs$sr, sumres$YTR,col=4, las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1)
abline(lm(sumres$YTR~inputs$sr),col=4,lty=2)
```

## Explaining injury metrics across species

Here we consider standard linear models to explain the injury metrics as a function of the input parameters. To obtain what we considered the most parsimonious model we conducted a traditional model selection approach using AIC, selecting the model  with the lowest AIC. 

We considered only the 4 explanatory variables which, given the exploratory data analysis above, could explain the injury metrics. Given only 4 explanatory variables, we conducted a full search over the possible models, ignoring interactions, using function bestglm from the package bestglm (McLeod & Lai, 2020).

### LCY

The summary of the best linear model follows.

```{r}
LCY4bestglm <- data.frame(gd = inputs$gd, sr = inputs$sr, N = sumres$Nstart, p = sumres$Pexp,y = sumres$LCY)
bestLCY <- bestglm(LCY4bestglm, family = gaussian, IC = "AIC", t = "default",
        CVArgs = "default", qLevel = 0.95, TopModels = 5,
        method = "exhaustive", intercept = TRUE)
bestLCY
#make it a proper lm model to use anova function
lmLCY <- lm(y ~ p + N, data = LCY4bestglm)
summary(lmLCY)
```

We can look at the ANOVA table for the most parsimonious model based on lowest AIC criteria.

```{r,echo=FALSE}
anova(lmLCY)
```

```{r,echo=FALSE}
propvarLCY<-round(100*anova(lmLCY)$'Sum Sq'/sum(anova(lmLCY)$'Sum Sq')[1],2)
```

Using the most parsimonious model, the proportion of the variability explained by each input retained in the regression model and the remaining unexplained variation can be obtained from the ANOVA table of the linear regression (as shown above). The proportion of variance explained in Lost Cetacean Years by the initial population size is `r propvarLCY[2]` %, while the proportion exposed accounts for `r propvarLCY[1]` %. Only `r propvarLCY[3]` of the variability remains unexplained.

We illustrate how well the model predicts the observed values in the plot below:

```{r}
plot(LCY4bestglm$y, predict(lmLCY), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1,xlab="Observed Lost Cetacean Years",ylab="Predicted Lost Cetacean Years")
```


### YTR

The summary of the best linear model follows.

```{r}
YTR4bestglm <- data.frame(gd = inputs$gd, sr = inputs$sr, N = sumres$Nstart, p = sumres$Pexp,y = sumres$YTR)
bestYTR <- bestglm(YTR4bestglm, family = gaussian, IC = "AIC", t = "default",
        CVArgs = "default", qLevel = 0.95, TopModels = 5,
        method = "exhaustive", intercept = TRUE)
bestYTR
#make it a proper lm model to use anova function
lmYTR <- lm(y ~ p + gd, data = YTR4bestglm)
summary(lmYTR)
```

We can look at the ANOVA table for the most parsimonious model based on lowest AIC criteria.

```{r,echo=FALSE}
anova(lmYTR)
```


```{r,echo=FALSE}
propvarYTR<-round(100*anova(lmYTR)$'Sum Sq'/sum(anova(lmYTR)$'Sum Sq')[1],2)
```


The proportion of variance explained in Years to Recovery by the proportion exposed is `r propvarYTR[1]` %, while the gestation duration accounts for `r propvarYTR[2]`  %. About `r propvarYTR[3]` % of the total variability remains unexplained.

We illustrate how well the model predicts the observed values in the plot below:

```{r}
plot(YTR4bestglm$y, predict(lmYTR), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1,xlab="Observed Years to Recovery",ylab="Predicted  Years to Recovery")
```


### MPD

The summary of the best linear model follows.

```{r}
MPD4bestglm <- data.frame(gd = inputs$gd, sr = inputs$sr, N = sumres$Nstart, p = sumres$Pexp,y = sumres$MPD)
bestMPD <- bestglm(MPD4bestglm, family = gaussian, IC = "AIC", t = "default",
        CVArgs = "default", qLevel = 0.95, TopModels = 5,
        method = "exhaustive", intercept = TRUE)
bestMPD
#make it a proper lm model to use anova function
lmMPD <- lm(y ~ p + gd + sr, data = MPD4bestglm)
summary(lmMPD)
```

We can look at the ANOVA table for the most parsimonious model based on lowest AIC criteria.

```{r,echo=FALSE}
anova(lmMPD)
```

```{r,echo=FALSE}
propvarMPD<-round(100*anova(lmMPD)$'Sum Sq'/sum(anova(lmMPD)$'Sum Sq')[1],2)
```

The proportion of variance explained in MPD by the proportion exposed is `r propvarMPD[1]`, while the gestation duration and the survival reduction only account for only  `r propvarMPD[2]` % and `r propvarMPD[3]` %, respectively. About  `r propvarMPD[4]` % of the variability remains unexplained.

We illustrate how well the model predicts the observed values in the plot below:

```{r}
plot(MPD4bestglm$y, predict(lmMPD), las = 1, cex.axis=1.2,cex.main=1.5,cex.lab=1.1,xlab="Observed Maximum Proportional Decrease",ylab="Predicted  Maximum Proportional Decrease")
```


# References

DWH MMIQT 2015, Models and analyses for the quantification of injury to Gulf of Mexico cetaceans from the Deepwater Horizon Oil Spill, MM_TR.01_Schwacke_Quantification.of.lnjury.to.GOM.Cetaceans [LINK](https://www.fws.gov/doiddata/dwh-ar-documents/876/DWH-AR0105866.pdf).

McLeod A, Xu C, Lai Y (2020). bestglm: Best Subset GLM and Regression Utilities. R package version 0.37.3, <https://CRAN.R-project.org/package=bestglm>.

Schwacke, L.H., L. Thomas, R.S. Wells, W.E. McFee, A.A. Hahn, K.D. Mullin, E.S. Zolman, B.M. Quigley, T.K. Rowles and J.H. Schwacke. 2017. An age-, sex- and class-structured population model for estimating nearshore common bottlenose dolphin injury following the Deepwater Horizon oil spill. *Endangered Species Research* **33**: 265-279. DOI: [10.3354/esr00777](https://doi.org/10.3354/esr00777).